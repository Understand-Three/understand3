---
title: 无密钥账户
---
```yaml
original: "https://learn.aptoslabs.com/example/aptogotchi-keyless/ephemeral-keys"
note: 正在编辑
```
在 [Google API 控制台](https://console.developers.google.com/) 中设置你的项目。

上方的`下拉选择器`中`创建项目` -> 在`左侧菜单`中选择 `API 和服务` -> `凭据` -> 上方`创建凭据` -> `OAuth 客户端 ID`  -> `配置同意屏幕` -> `外部` -> `创建` -> `发布应用` -> `提交验证`

`创建凭据` -> `创建 OAuth 客户端 ID`

`https://localhost:3000/callback`

复制客户端 ID`40609952844-qe39u8kf3jeprrm21r0nahqce5bn5g90.apps.googleusercontent.com`

客户端密钥`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`

安装 aptos-ts-sdk

```bash
pnpm install @aptos-labs/ts-sdk@zeta
```

创建文件
```ts title="hooks/useEphemeralKeyPair.ts'
// 从 Aptos Labs 的 TypeScript SDK 中导入 EphemeralKeyPair 类型
import { EphemeralKeyPair } from '@aptos-labs/ts-sdk';

/**
 * 定义一个类型，用于存储在 localStorage 中的临时密钥对（nonce -> ephemeralKeyPair）
 */
export type StoredEphemeralKeyPairs = { [nonce: string]: EphemeralKeyPair };

/**
 * 将新的临时密钥对存储到 localStorage 中，并对其进行编码。
 * 通过 nonce 作为键来存储，以便检索。
 */
export const storeEphemeralKeyPair = (
  ephemeralKeyPair: EphemeralKeyPair,
): void => {
  // 从 localStorage 中检索当前存储的临时密钥对
  const accounts = getLocalEphemeralKeyPairs();

  // 将新的临时密钥对存储到 localStorage 中
  accounts[ephemeralKeyPair.nonce] = ephemeralKeyPair;
  localStorage.setItem(
    "ephemeral-key-pairs",
    encodeEphemeralKeyPairs(accounts),
  );
};

/**
 * 从 localStorage 中检索所有编码后的临时密钥对，并尝试进行解码。
 */
export const getLocalEphemeralKeyPairs = (): StoredEphemeralKeyPairs => {
  const rawEphemeralKeyPairs = localStorage.getItem("ephemeral-key-pairs");
  try {
    // 如果存在存储的密钥对，则解码它们
    return rawEphemeralKeyPairs
      ? decodeEphemeralKeyPairs(rawEphemeralKeyPairs)
      : {};
  } catch (error) {
    // 如果解码失败，打印警告并返回一个空对象
    console.warn("Failed to decode ephemeral key pairs from localStorage", error);
    return {};
  }
};

/**
 * 定义编码和解码 EphemeralKeyPair 类型的方法，以便它们可以被存储在 localStorage 中
 */
const EphemeralKeyPairEncoding = {
  decode: (e: any) => EphemeralKeyPair.fromBytes(e.data),
  encode: (e: EphemeralKeyPair) => ({ __type: 'EphemeralKeyPair', data: e.bcsToBytes() }),
};

/**
 * 将存储的临时密钥对集合编码为 JSON 字符串，以便存储在 localStorage 中
 */
export const encodeEphemeralKeyPairs = (
  keyPairs: StoredEphemeralKeyPairs,
): string =>
  JSON.stringify(keyPairs, (_, e) => {
    if (typeof e === "bigint") return { __type: "bigint", value: e.toString() };
    if (e instanceof Uint8Array)
      return { __type: "Uint8Array", value: Array.from(e) };
    if (e instanceof EphemeralKeyPair)
      return EphemeralKeyPairEncoding.encode(e);
    return e;
  });

/**
 * 从 JSON 字符串中解析临时密钥对集合
 */
export const decodeEphemeralKeyPairs = (
  encodedEphemeralKeyPairs: string,
): StoredEphemeralKeyPairs =>
  JSON.parse(encodedEphemeralKeyPairs, (_, e) => {
    if (e && e.__type === "bigint") return BigInt(e.value);
    if (e && e.__type === "Uint8Array") return new Uint8Array(e.value);
    if (e && e.__type === "EphemeralKeyPair")
      return EphemeralKeyPairEncoding.decode(e);
    return e;
  });

/**
 * 生成一个新的临时密钥对并将其存储到 localStorage 中
 */
export default function useEphemeralKeyPair() {
  const ephemeralKeyPair = EphemeralKeyPair.generate();
  storeEphemeralKeyPair(ephemeralKeyPair);

  return ephemeralKeyPair;
}
```



```ts title="WalletButtons/index.tsx"
import { useKeylessAccount } from "@/context/KeylessAccountContext";

const ephemeralKeyPair = useEphemeralKeyPair();
```